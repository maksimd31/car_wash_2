{% extends 'base_reg.html' %}
<!--{% load custom_filters %}-->

{% block content %}

<p>
    <a class="btn btn-primary" data-bs-toggle="collapse" href="#collapseExample" role="button" aria-expanded="false"
       aria-controls="collapseExample">
        Информация
    </a>
    <button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#collapseExample1"
            aria-expanded="false" aria-controls="collapseExample">
        update
    </button>

    <button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#collapseExample2"
            aria-expanded="false" aria-controls="collapseExample">
        Bug-fix
    </button>
</p>
<div class="collapse" id="collapseExample">
    <div class="card card-body">
        <p>Могут присутствовать баги, если что-то заметили, просьба написать мне в телегу @The_Chef12 </p>
        <p>Развивать сервис не планируется, если у кого-то есть заинтересованность, пишите. </p>
    </div>
</div>
<div class="collapse" id="collapseExample1">
    <div class="card card-body">
        <p>20.11.24 - добавлен функционал "удаление итогов" для отладки, будьте осторожны </p>
        <p>21.11.24 - добавлен функционал "Внесения времени вручную" </p>

    </div>
</div>
<div class="collapse" id="collapseExample2">
    <div class="card card-body">
        <p>20.11.24 - Исправлен не правильный подсчет итогового времени. </p>
        <p>22.11.24 - Исправлено отображение итогов дня, теперь передается вся информация. </p>
    </div>
</div>

<!--<h1>Секундомер</h1>-->


<!--<h1 id="timer">00:00:00</h1>-->
<!--<button id="startBtn">Старт</button>-->
<!--<button id="pauseBtn" disabled>Пауза</button>-->
<!--<button id="resetBtn" disabled>Сброс</button>-->


<!--<form method="post" id="timerForm">-->
<!--    {% csrf_token %}-->
<!--    <button type="submit" name="start" id="startButton">Старт</button>-->
<!--    <button type="submit" name="stop" id="stopButton">Стоп</button>-->

<!--    <button type="submit" name="reset" style="background-color: red; color: white;">Обнулить данные</button>-->
<!--    <button type="submit" name="delete_summary" style="background-color: red; color: white;">УДАЛИТЬ ИТОГОВЫЕ ДАННЫЕ-->
<!--    </button>-->

<!--    <input type="hidden" id="currentSeconds" name="current_seconds" value="0">-->
<!--</form>-->
<h1>Секундомер</h1>
<h1 id="timer">00:00:00</h1>
<button id="startBtn">Старт</button>
<button id="pauseBtn" disabled>Пауза</button>
<button id="resetBtn" disabled>Сброс</button>

<form method="post" id="timerForm">
    {% csrf_token %}
    <input type="hidden" id="currentSeconds" name="current_seconds" value="0">
    <button type="submit" name="stop" id="stopBtn" disabled>Стоп</button>
    <button type="submit" name="reset" style="background-color: red; color: white;">Обнулить данные</button>
    <button type="submit" name="delete_summary" style="background-color: red; color: white;">УДАЛИТЬ ИТОГОВЫЕ ДАННЫЕ</button>
</form>


<form method="POST">
    {% csrf_token %}
    <h2>Добавить новый интервал вручную</h2>

    <div>
        <label for="start_time">Начало (HH:MM):</label>
        <input type="time" id="start_time" name="start_time" required>
    </div>

    <div>
        <label for="end_time">Конец (HH:MM):</label>
        <input type="time" id="end_time" name="end_time" required>
    </div>

    <div>
        <button type="submit" name="add_manual_interval">Добавить интервал вручную</button>
    </div>
</form>

{% if messages %}
<ul>
    {% for message in messages %}
    <li>{{ message }}</li>
    {% endfor %}
</ul>
{% endif %}


<h2>Интервалы времени</h2>
<div class="table-responsive">
    <table class="table table-striped table-hover table-bordered">
        <thead class="table-dark">
        <tr>
            <th scope="col">Старт</th>
            <th scope="col">Стоп</th>
            <th scope="col">Длительность</th>
        </tr>
        </thead>
        <tbody>
        {% for interval in formatted_intervals %}
        <tr>
            <td>{{ interval.start_time }}</td>
            <td>{{ interval.end_time }}</td>
            <td>{{ interval.duration }}</td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
</div>

<h2>Итоги дня</h2>
<div class="table-responsive">
    <table class="table table-striped table-hover table-bordered">
        <thead class="table-dark">
        <tr>
            <th scope="col">Дата</th>
            <th scope="col">Количество интервалов</th>
            <th scope="col">Итоговое время</th>
        </tr>
        </thead>
        <tbody>
        {% for summary in daily_summaries %}
        <tr>
            <td>{{ summary.date }}</td>
            <td>{{ summary.interval_count }}</td>
            <td>
                {% if summary.total_time %}
                {{ summary.total_time|duration_format }}
                {% else %}
                00:00:00
                {% endif %}
            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
</div>
</body>

<script>
    let timer = document.getElementById('timer');
    let startBtn = document.getElementById('startBtn');
    let stopBtn = document.getElementById('stopBtn');
    let pauseBtn = document.getElementById('pauseBtn');
    let resetBtn = document.getElementById('resetBtn');
    let currentSecondsInput = document.getElementById('currentSeconds');

    let seconds = 0;
    let interval;

    function updateTime() {
        seconds++;
        let hours = Math.floor(seconds / 3600);
        let minutes = Math.floor((seconds % 3600) / 60);
        let secs = seconds % 60;
        timer.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        currentSecondsInput.value = seconds; // Обновляем скрытое поле с текущими секундами
    }

    startBtn.addEventListener('click', () => {
        interval = setInterval(updateTime, 1000);
        startBtn.disabled = true;
        stopBtn.disabled = false; // Активируем кнопку "Стоп"
        pauseBtn.disabled = false;
        resetBtn.disabled = false;
    });

    stopBtn.addEventListener('click', () => {
        clearInterval(interval);
        startBtn.disabled = false;
        stopBtn.disabled = true; // Деактивируем кнопку "Стоп"
        pauseBtn.disabled = true;

        // Отправляем форму при нажатии на кнопку "Стоп"
        document.getElementById('timerForm').submit(); // Отправляем форму
    });

    pauseBtn.addEventListener('click', () => {
        clearInterval(interval);
        startBtn.disabled = false;
        stopBtn.disabled = true; // Деактивируем кнопку "Стоп"
        pauseBtn.disabled = true;
    });

    resetBtn.addEventListener('click', () => {
        clearInterval(interval);
        seconds = 0;
        timer.textContent = '00:00:00';
        currentSecondsInput.value = 0; // Сбрасываем скрытое поле
        startBtn.disabled = false;
        stopBtn.disabled = true; // Деактивируем кнопку "Стоп"
        pauseBtn.disabled = true;
        resetBtn.disabled = true;
    });
</script>

<!--<script>-->
<!--    let timer = document.getElementById('timer');-->
<!--    let startBtn = document.getElementById('startBtn');-->
<!--    let pauseBtn = document.getElementById('pauseBtn');-->
<!--    let resetBtn = document.getElementById('resetBtn');-->

<!--    let seconds = 0;-->
<!--    let minutes = 0;-->
<!--    let hours = 0;-->
<!--    let interval;-->

<!--    function updateTime() {-->
<!--      seconds++;-->
<!--      if (seconds === 60) {-->
<!--        minutes++;-->
<!--        seconds = 0;-->
<!--      }-->
<!--      if (minutes === 60) {-->
<!--        hours++;-->
<!--        minutes = 0;-->
<!--      }-->
<!--      timer.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;-->
<!--    }-->

<!--    startBtn.addEventListener('click', () => {-->
<!--      interval = setInterval(updateTime, 1000);-->
<!--      startBtn.disabled = true;-->
<!--      pauseBtn.disabled = false;-->
<!--      resetBtn.disabled = false;-->
<!--    });-->

<!--    pauseBtn.addEventListener('click', () => {-->
<!--      clearInterval(interval);-->
<!--      startBtn.disabled = false;-->
<!--      pauseBtn.disabled = true;-->
<!--    });-->

<!--    resetBtn.addEventListener('click', () => {-->
<!--      clearInterval(interval);-->
<!--      seconds = 0;-->
<!--      minutes = 0;-->
<!--      hours = 0;-->
<!--      timer.textContent = '00:00:00';-->
<!--      startBtn.disabled = false;-->
<!--      pauseBtn.disabled = true;-->
<!--      resetBtn.disabled = true;-->
<!--    });-->
<!--</script>-->


{% endblock %}


